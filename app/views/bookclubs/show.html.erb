<%= render 'popup' %>
<%= render 'members' %>

<div class="container">
  <div class="bookclub-wrapper purple">
    <% if @bookclub.photos.attached? %>
      <%= image_tag @bookclub.photos[0], crop: :limit, class:"bookclub-img"%>
    <% else %>
      <%= image_tag "https://images.unsplash.com/photo-1546284663-fed719f6612e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=657&q=80", crop: :limit, class:"bookclub-img"%>
    <% end %>
    
    <div class="bookclub-user-info">
      <% if @bookclub.name.present? %>
        <h1 style="width: 520px"><%= @bookclub.name %></h1>
      <% else %>
        <h1>Hello Stranger!</h1>
        <p><i class="fas fa-map-pin"></i>???</p>
      <% end %>
      <div class="bookclub-description">
        <% if @bookclub.description.present? %>
          <p><%= @bookclub.description %></p>
        <% else %>
          <p>Tell us about yourself, beautiful stranger!<p>
        <% end %>
      </div>
    </div>

    <div class="bookclub-page-books-wrapper">
      <div class="bookclubs-wrapper" style="cursor: pointer" data-toggle="modal" data-target=".bd-example-modal-lg2">
        <% @bookclub_users.take(3).each do |user|%>
          <%= image_tag user.user.photo %>
        <% end %>
        <% if @bookclub_users.length == 3 %>
        <% else %>
            <p>+<%= @bookclub_users.length - 3 %> more members</p>
        <% end %>
      </div>

      <div class="bookclub-books-wrapper" style="cursor: pointer" data-toggle="modal" data-target=".bd-example-modal-lg">
        <% @bookclub_users.take(3).each do |user| %>
          <% user.user.books.take(1).each do |book| %>
                <%= image_tag book.photos[0] %>
          <% end %>
        <% end %>
        <p>
          +<%= @bookclub_books.length - 3 %> more books
        </p>
      </div>
    </div>
 
    <% if !current_user.in?(@bookclub.members) %>
      <%= link_to "Join now!", join_path, :method => :post, class:"button-red-profile", id:"joinbookclub", remote: true %>
    <% end %>
  </div>
    <div class="background-create-wrapper-thread">
      <div class="header-create-form">
        <h2>Bookclub Talks</h2> 
        <%= image_tag "figures/2.png", id:"figure-reading-thread" %>
      </div>
      <div class="create-thread-box">
        <div class="nested-create-thread-form">
          <%= render "bookclub_threads/new", bookclub: @bookclub, bookclub_thread: @bookclub_thread %>
        </div>
      </div>
      <% @bookclub.bookclub_threads.each do |bookclub_thread| %>
        <div class="existing-threads-box">
          <div class="nested-existing-threads">
          <!-- <div class="card-thread mt-3"> -->
            <h3><%= bookclub_thread.title %></h3>
            <p><%= bookclub_thread.content %></p>
          </div>
          <div class="avatar-thread">
            <%= image_tag bookclub_thread.user.photo, class:"avatar-bordered"%>
          </div>
          <div class="functional-buttons">
            <% if current_user != @bookclub_thread.user %>
              <%= link_to edit_bookclub_bookclub_thread_path(@bookclub, bookclub_thread) do %>
                <i class="fas fa-edit"></i>
              <% end %>
              <%= link_to bookclub_bookclub_thread_path(bookclub_thread), method: :delete, data: { confirm: 'Are you sure?' } do %>
                <i class="fas fa-trash mr-2"></i>
              <% end %>
            <% end %>
          </div>
        <!-- </div> -->
        </div>
      <% end %>
    </div>
  </div>
  <div class="container text-center my-5">
    <div class="mb-5">
      <%= link_to "Offer a new book", new_book_path, :method => :get, class:"button-red-profile"  %>
      <%= link_to "Go back to your profile", page_path(current_user), :method => :get, class:"button-red-profile" if user_signed_in?  %>
    </div>
  </div>
</div>
