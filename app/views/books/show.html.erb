<div class="container ml-5 mt-3 d-flex align-items-center go-back">
  <i class="fas fa-caret-left"></i>
  <%= link_to "Go back", books_path, method: :get, id: "books-link", class: "ml-2" %>
</div>
<div class="container d-flex flex-column my-5" style="align-items: center">
  <div class="row">
    <div class="book-card mt-5">
      <div class="book-pic">
        <% if @book.photos.attached? %>
          <%= cl_image_tag @book.photos[0].key, crop: :fill, class:"avatar-book" %>
        <% else %>
          <%= image_tag "https://images.unsplash.com/photo-1575709527142-a93ed587bb83?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=800&q=80", class: "avatar-book" %>
        <% end %>
      </div>
      <div class="book-details">
        <h2> <strong> <%= @book.title %> </strong> </h2>
        <h3> <strong> <%= @book.author %> </strong> </h3>
        <p> <%= @book.year %> | <%= @book.pages %> pages </p>
        <h3> <i class="fas fa-map-marker-alt"></i>  <strong> <%= @book.user.address %> </strong> </h3>
        <p> <%= @book.description %></p>
        <% if @book.availability? && current_user != @book.user %>
          <%= link_to new_book_booking_path(@book) do %>
            <button class="btn button-red">Booking Request</button>
          <% end %>
        <% else %>
          <button id="btn-disabled">Booking Request</button>
          <p> <%= image_tag "warning.png", id:"warning"%> <%= "This book will be available from #{@book.bookings.last.until.next.to_formatted_s(:long)}." %> </p>
          <%= image_tag "figures/5.png", id:"figure-crying" %>
        <% end %>
          <div>
          <% if policy(@book).update? %>
            <%= link_to edit_book_path(@book) do %>
              <button class="btn button-red mr-3">Edit your book</button>
            <% end %>
          <% end %>
          <% if policy(@book).destroy? %>
            <%= link_to @book, method: :delete, data: { confirm: 'Are you sure?' } do %>
              <button class="btn button-red">Delete your book</button>
            <% end %>
          <% end %>
        </div>
      </div>
      <div>
        <% if @book.user.photo.attached? %>
          <div class="book-user">
            <%= cl_image_tag @book.user.photo.key, class: "avatar-large", crop: :fill %>
            <p> <%= link_to "#{@book.user.first_name}", profile_path(@book.user) %> </p>
          </div>
        <% else %>
          <%= image_tag "https://kitt.lewagon.com/placeholder/users/krokrob", class: "user-avatar" %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="card-review mt-5">
      <h2><%= "What others say about #{@book.title}" %></h2>
      <% if @book.reviews.empty? %>
        <div class= "text-center">
          <p>Nothing here yet! Be the first to leave a review.</p>
        </div>
      <% else %>
          <% @book.reviews.each do |review| %>
            <div class="card-book-review mb-3">
              <h2><%= review.user.nickname %></h2>
              <p><%= review.book_comment %></p>
              <% if review.book_rating %>
                <div class="fa-stars">
                  <% counter = 0 %>
                  <% 5.times do %>
                    <i class="fa <%= review.book_rating > counter ? 'fa-star' : 'fa-star-o' %>"></i>
                    <% counter += 1 %>
                  <% end %>
                </div>
                <% if current_user == review.user %>
                  <div class="review-edit">
                    <%= link_to edit_book_review_path(@book, review) do %>
                      <i class="fas fa-edit"></i>
                    <% end %>
                    <%= link_to book_review_path(review), method: :delete, data: { confirm: 'Are you sure?' } do %>
                      <i class="fas fa-trash mr-2 mt-2"></i>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            </div>
          <% end %>
      <% end %>
      <div class="write-review">
        <%= render "reviews/new", book: @book, review: @review %>
      </div>
    </div>
  </div>
</div>
